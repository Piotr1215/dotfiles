#!/bin/bash

echo "Hook running from: $0" >&2
echo "Current directory: $(pwd)" >&2

protected_branches=('main' 'master')
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

echo "Current branch: $current_branch" >&2
echo "Protected branches: ${protected_branches[*]}" >&2

if [[ " ${protected_branches[*]} " =~ " ${current_branch} " ]]; then
    echo "ðŸš« Blocking push to protected branch: $current_branch" >&2
    exit 1
fi

full_branch=$(git symbolic-ref --short HEAD)
branch_suffix="${full_branch##*/}"

if [[ "$branch_suffix" =~ ^[0-9_-]+$ ]]; then
    echo "ðŸš« Branch has auto-generated slug: $full_branch" >&2
    echo "   Suffix '$branch_suffix' contains no letters - likely auto-generated" >&2
    echo "   Rename to something meaningful:" >&2
    echo "   git branch -m $full_branch ${full_branch%/*}/descriptive-slug" >&2
    exit 1
fi

echo "âœ… Push allowed" >&2
exit 0
