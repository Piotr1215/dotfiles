name: loft-prod-cluster
root: /home/decoder/loft/clusters/loft-rocks-prod

windows:
  - loft-prod-cluster:
      layout: b1cf,294x72,0,0[294x65,0,0,52,294x6,0,66,56]
      panes:
        - |
          ./generate-kubeconfig.sh
          clear
        - |
          CLUSTER_ENDPOINT=$(gcloud container clusters describe loft-prod-cluster --zone=us-central1 --project=loft-prod --format="value(endpoint)")
          ENGINEERING_ENDPOINT=$(gcloud container clusters describe loft-prod-engineering --zone=europe-west3 --project=loft-prod --format="value(endpoint)")
          WORKER_EU_ENDPOINT=$(gcloud container clusters describe loft-prod-worker-eu --zone=europe-west3 --project=loft-prod --format="value(endpoint)")
          WORKER_NA_ENDPOINT=$(gcloud container clusters describe loft-prod-worker-na --zone=us-west1 --project=loft-prod --format="value(endpoint)")

          gcloud compute ssh kubectl-bastion \
            --zone=us-central1-a \
            --tunnel-through-iap \
            --project=loft-prod \
            --ssh-flag="-L 8443:${CLUSTER_ENDPOINT}:443" \
            --ssh-flag="-L 8444:${ENGINEERING_ENDPOINT}:443" \
            --ssh-flag="-L 8445:${WORKER_EU_ENDPOINT}:443" \
            --ssh-flag="-L 8446:${WORKER_NA_ENDPOINT}:443" \
            --ssh-flag="-o ServerAliveInterval=60" \
            --command="echo 'Tunnels established. Keep this window open.'; sleep infinity"