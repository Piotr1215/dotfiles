#compdef fifp

_fifp() {
    local -a projects
    local dirs=(~/.claude ~/.task ~/dev ~/loft)

    projects=( ${(f)"$(rg -h '(#|--|//) PROJECT:' ${dirs[@]} 2>/dev/null | grep -oP 'PROJECT: \K[a-zA-Z0-9_-]+' | sort -u)"} )

    _arguments \
        '-l[List files with project tag]' \
        '*:project:->projects'

    case "$state" in
        projects)
            _describe -t projects 'project' projects
            ;;
    esac
}

_fifp
